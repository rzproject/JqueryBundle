(function(b){var q=function(a,c){this.options=c;this.$element=b(a);this.$container=b('<div id="ms-'+this.$element.attr("id")+'" class="ms-container"></div>');this.$selectableContainer=b('<div class="ms-selectable"></div>');this.$selectionContainer=b('<div class="ms-selection"></div>');this.$selectableUl=b('<ul class="ms-list"></ul>');this.$selectionUl=b('<ul class="ms-list"></ul>');this.scrollTo=0};q.prototype={constructor:q,init:function(){var a=this,c=this.$element;if(c.next(".ms-container").length==
0){c.css({position:"absolute",left:"-9999px"});c.attr("id",c.attr("id")?c.attr("id"):"ms-"+Math.ceil(Math.random()*1E3));var f=null,h=null,i=0;c.find("optgroup, option").each(function(){if(b(this).is("optgroup")){f="<span>"+b(this).attr("label")+"</span>";h="ms-"+c.attr("id")+"-optgroup-"+i;var j=b(this),e=b('<li class="ms-optgroup-container"></li>'),g=b('<li class="ms-optgroup-container"></li>'),d=b('<li class="ms-optgroup-label"><span></span></li>'),l=b('<li class="ms-optgroup-label"><span></span></li>');
if(a.options.selectableOptgroup){l.on("click",function(){var k=j.children(":not(:selected)").map(function(){return b(this).val()}).get();a.select(k)});d.on("click",function(){var k=j.children(":selected").map(function(){return b(this).val()}).get();a.deselect(k)})}l.html(f);e.attr("id",h+"-selectable").append(b('<ul class="ms-optgroup"></ul>').append(l));a.$selectableUl.append(e);d.html(f);g.attr("id",h+"-selection").append(b('<ul class="ms-optgroup"></ul>').append(d));a.$selectionUl.append(g);i++}else{e=
"";for(g=0;g<this.attributes.length;g++){d=this.attributes[g];if(a.isDomNode(d.name))e+=d.name+'="'+d.value+'" '}e=b("<li "+e+"><span>"+b(this).text()+"</span></li>");g=e.clone();d=b(this).val();l=a.sanitize(d);e.data("ms-value",d).addClass("ms-elem-selectable").attr("id",l+"-selectable");g.data("ms-value",d).addClass("ms-elem-selection").attr("id",l+"-selection").hide();a.$selectionUl.find(".ms-optgroup-label").hide();if(b(this).prop("disabled")||c.prop("disabled"))if(this.selected){g.prop("disabled",
true);g.addClass(a.options.disabledClass)}else{e.prop("disabled",true);e.addClass(a.options.disabledClass)}if(h){a.$selectableUl.children("#"+h+"-selectable").find("ul").first().append(e);a.$selectionUl.children("#"+h+"-selection").find("ul").first().append(g)}else{a.$selectableUl.append(e);a.$selectionUl.append(g)}}});a.options.selectableHeader&&a.$selectableContainer.append(a.options.selectableHeader);a.$selectableContainer.append(a.$selectableUl);a.options.selectableFooter&&a.$selectableContainer.append(a.options.selectableFooter);
a.options.selectionHeader&&a.$selectionContainer.append(a.options.selectionHeader);a.$selectionContainer.append(a.$selectionUl);a.options.selectionFooter&&a.$selectionContainer.append(a.options.selectionFooter);a.$container.append(a.$selectableContainer);a.$container.append(a.$selectionContainer);c.after(a.$container);a.$selectableUl.on("mouseenter",".ms-elem-selectable",function(){b("li",a.$container).removeClass("ms-hover");b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",a.$container).removeClass("ms-hover")});
if(a.options.dblClick){a.$selectableUl.on("dblclick",".ms-elem-selectable",function(){a.select(b(this).data("ms-value"))});a.$selectionUl.on("dblclick",".ms-elem-selection",function(){a.deselect(b(this).data("ms-value"))})}else{a.$selectableUl.on("click",".ms-elem-selectable",function(){a.select(b(this).data("ms-value"))});a.$selectionUl.on("click",".ms-elem-selection",function(){a.deselect(b(this).data("ms-value"))})}a.$selectionUl.on("mouseenter",".ms-elem-selection",function(){b("li",a.$selectionUl).removeClass("ms-hover");
b(this).addClass("ms-hover")}).on("mouseleave",function(){b("li",a.$selectionUl).removeClass("ms-hover")});a.$selectableUl.on("focusin",function(){b(this).addClass("ms-focus");a.$selectionUl.focusout()}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",a.$container).removeClass("ms-hover")});a.$selectionUl.on("focusin",function(){b(this).addClass("ms-focus")}).on("focusout",function(){b(this).removeClass("ms-focus");b("li",a.$container).removeClass("ms-hover")});c.on("focusin",function(){c.focusout();
a.$selectableUl.focusin()}).on("focusout",function(){a.$selectableUl.removeClass("ms-focus");a.$selectionUl.removeClass("ms-focus")});c.onKeyDown=function(j,e){var g=a.$container.find("."+e).find(".ms-list"),d=g.find("li:visible:not(.ms-optgroup-label, .ms-optgroup-container)"),l=d.length,k=g.find("li.ms-hover"),m=k.length>0?d.index(k):-1,r=g.innerHeight(),o=d.first().outerHeight(true);r=Math.floor(r/o);if(j.keyCode==32){if(k.length>0){e=="ms-selectable"?a.select(k.data("ms-value")):a.deselect(k.data("ms-value"));
d.removeClass("ms-hover");a.scrollTo=0;g.scrollTop(a.scrollTo)}}else if(j.keyCode==40){if(d.length>0){m=m+1;var p=l!=m?d.eq(m):d.first();k=g.position().top;var s=p.position().top;d.removeClass("ms-hover");p.addClass("ms-hover");if(l==m)a.scrollTo=0;else if(s>=k+r*o)a.scrollTo+=o;g.scrollTop(a.scrollTo)}}else if(j.keyCode==38){if(d.length>0){m=Math.max(m-1,-1);p=d.eq(m);k=g.position().top;s=p.position().top;d.removeClass("ms-hover");p.addClass("ms-hover");if(s<=k)a.scrollTo-=o;else if(m<0)a.scrollTo=
(l-r)*o;g.scrollTop(a.scrollTo)}}else if(j.keyCode==37||j.keyCode==39)if(a.$selectableUl.hasClass("ms-focus")){a.$selectableUl.focusout();a.$selectionUl.focusin()}else{a.$selectableUl.focusin();a.$selectionUl.focusout()}};c.on("keydown",function(j){if(c.is(":focus")){var e=a.$selectableUl.hasClass("ms-focus")?"ms-selectable":"ms-selection";c.onKeyDown(j,e)}})}var n=c.find("option:selected").map(function(){return b(this).val()}).get();a.select(n,"init");typeof a.options.afterInit=="function"&&a.options.afterInit.call(this,
this.$container)},refresh:function(){b("#ms-"+this.$element.attr("id")).remove();this.init(this.options)},select:function(a,c){if(typeof a=="string")a=[a];var f=this,h=this.$element,i=b.map(a,function(e){return f.sanitize(e)}),n=this.$selectableUl.find("#"+i.join("-selectable, #")+"-selectable").filter(":not(."+f.options.disabledClass+")");i=this.$selectionUl.find("#"+i.join("-selection, #")+"-selection");var j=h.find("option").filter(function(){return b.inArray(this.value,a)>-1});if(n.length>0){n.addClass("ms-selected").hide();
i.addClass("ms-selected").show();j.prop("selected",true);n=f.$selectableUl.children(".ms-optgroup-container");if(n.length>0){n.each(function(){var e=b(this).find(".ms-elem-selectable");e.length==e.filter(".ms-selected").length&&b(this).find(".ms-optgroup-label").hide()});f.$selectionUl.children(".ms-optgroup-container").each(function(){b(this).find(".ms-elem-selection").filter(".ms-selected").length>0&&b(this).find(".ms-optgroup-label").show()})}if(c!="init"){f.$selectionUl.focusout();f.$selectableUl.focusin();
h.trigger("change");typeof f.options.afterSelect=="function"&&f.options.afterSelect.call(this,a)}}},deselect:function(a){if(typeof a=="string")a=[a];var c=this,f=this.$element,h=b.map(a,function(j){return c.sanitize(j)}),i=this.$selectableUl.find("#"+h.join("-selectable, #")+"-selectable");h=this.$selectionUl.find("#"+h.join("-selection, #")+"-selection").filter(".ms-selected");var n=f.find("option").filter(function(){return b.inArray(this.value,a)>-1});if(h.length>0){i.removeClass("ms-selected").show();
h.removeClass("ms-selected").hide();n.prop("selected",false);i=c.$selectableUl.children(".ms-optgroup-container");if(i.length>0){i.each(function(){b(this).find(".ms-elem-selectable").filter(":not(.ms-selected)").length>0&&b(this).find(".ms-optgroup-label").show()});c.$selectionUl.children(".ms-optgroup-container").each(function(){b(this).find(".ms-elem-selection").filter(".ms-selected").length==0&&b(this).find(".ms-optgroup-label").hide()})}this.$selectableUl.focusout();this.$selectionUl.focusin();
f.trigger("change");typeof c.options.afterDeselect=="function"&&c.options.afterDeselect.call(this,a)}},select_all:function(){var a=this.$element,c=a.val();a.find("option").prop("selected",true);this.$selectableUl.find(".ms-elem-selectable").addClass("ms-selected").hide();this.$selectionUl.find(".ms-optgroup-label").show();this.$selectableUl.find(".ms-optgroup-label").hide();this.$selectionUl.find(".ms-elem-selection").addClass("ms-selected").show();this.$selectionUl.focusin();this.$selectableUl.focusout();
a.trigger("change");typeof this.options.afterSelect=="function"&&this.options.afterSelect.call(this,b.grep(a.val(),function(f){return b.inArray(f,c)<0}))},deselect_all:function(){var a=this.$element,c=a.val();a.find("option").prop("selected",false);this.$selectableUl.find(".ms-elem-selectable").removeClass("ms-selected").show();this.$selectionUl.find(".ms-optgroup-label").hide();this.$selectableUl.find(".ms-optgroup-label").show();this.$selectionUl.find(".ms-elem-selection").removeClass("ms-selected").hide();
this.$selectableUl.focusin();this.$selectionUl.focusout();a.trigger("change");typeof this.options.afterDeselect=="function"&&this.options.afterDeselect.call(this,c)},isDomNode:function(a){return a&&typeof a==="object"&&typeof a.nodeType==="number"&&typeof a.nodeName==="string"},sanitize:function(a){return a.replace(/[^A-Za-z0-9]*/gi,"_")}};b.fn.multiSelect=function(){var a=arguments[0],c=arguments;return this.each(function(){var f=b(this),h=f.data("multiselect"),i=b.extend({},b.fn.multiSelect.defaults,
f.data(),typeof a=="object"&&a);h||f.data("multiselect",h=new q(this,i));typeof a=="string"?h[a](c[1]):h.init()})};b.fn.multiSelect.defaults={selectableOptgroup:false,disabledClass:"disabled",dblClick:false};b.fn.multiSelect.Constructor=q})(window.jQuery);
